<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regalo Romántico Personalizado</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #FFF0F5;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #app {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 350px;
        }
        .screen {
            display: none;
        }
        .active {
            display: block;
        }
        h1, h2 {
            color: #FF69B4;
            text-align: center;
        }
        button {
            background-color: #FF69B4;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: block;
            width: 100%;
        }
        button:hover {
            background-color: #FF1493;
        }
        input[type="text"], input[type="password"], input[type="email"], input[type="tel"], textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #photo-gallery, #gift-photo-gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        #photo-gallery img, #gift-photo-gallery img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
        }
        .hidden {
            display: none;
        }
        .text-center {
            text-align: center;
        }
        .link {
            color: #FF69B4;
            cursor: pointer;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="home-screen" class="screen active">
            <h1>Regalo Romántico</h1>
            <button id="view-gift">Ver Regalo</button>
            <button id="admin-login">Administrador</button>
        </div>
        <div id="admin-login-screen" class="screen">
            <h2>Iniciar Sesión</h2>
            <input type="text" id="login-username" placeholder="Usuario">
            <input type="password" id="login-password" placeholder="Contraseña">
            <button id="login">Iniciar Sesión</button>
            <p class="text-center">¿No tienes cuenta? <span id="go-to-register" class="link">Regístrate</span></p>
            <p class="text-center"><span id="forgot-password" class="link">¿Olvidaste tu contraseña?</span></p>
        </div>
        <div id="register-screen" class="screen">
            <h2>Registro</h2>
            <input type="text" id="register-name" placeholder="Nombre completo">
            <input type="text" id="register-username" placeholder="Usuario">
            <input type="password" id="register-password" placeholder="Contraseña">
            <input type="email" id="register-email" placeholder="Correo electrónico">
            <input type="tel" id="register-phone" placeholder="Teléfono">
            <button id="register">Registrarse</button>
            <p class="text-center">¿Ya tienes cuenta? <span id="go-to-login" class="link">Inicia sesión</span></p>
        </div>
        <div id="forgot-password-screen" class="screen">
            <h2>Recuperar Contraseña</h2>
            <input type="text" id="recovery-username" placeholder="Usuario">
            <button id="send-recovery-code">Enviar Código de Recuperación</button>
            <div id="recovery-code-section" class="hidden">
                <input type="text" id="recovery-code" placeholder="Código de recuperación">
                <input type="password" id="new-password" placeholder="Nueva contraseña">
                <button id="reset-password">Restablecer Contraseña</button>
            </div>
        </div>
        <div id="admin-panel" class="screen">
            <h2>Panel de Administración</h2>
            <input type="file" id="photo-upload" accept="image/*" multiple class="hidden">
            <button id="upload-photos">Subir Fotos</button>
            <div id="photo-gallery"></div>
            <button id="save-photos">Guardar Fotos</button>
            <h3>Personalizar Mensajes Finales</h3>
            <textarea id="yes-message" rows="3" placeholder="Mensaje para 'Sí'"></textarea>
            <textarea id="no-message" rows="3" placeholder="Mensaje para 'No'"></textarea>
            <button id="save-messages">Guardar Mensajes</button>
            <button id="generate-link">Generar Enlace para Usuarios</button>
            <p id="generated-link"></p>
            <button id="copy-link">Copiar Enlace</button>
            <button id="admin-logout">Cerrar Sesión</button>
        </div>
        <div id="gift-screen" class="screen">
            <h2>Nuestros momentos juntos</h2>
            <div id="gift-photo-gallery"></div>
            <button id="continue-button">Continuar</button>
        </div>
        <div id="proposal-screen" class="screen">
            <h2>¿Quieres ser mi esposa?</h2>
            <button id="yes-button">Sí</button>
            <button id="no-button">No</button>
        </div>
        <div id="final-screen" class="screen">
            <h2 id="final-message"></h2>
            <p id="final-text"></p>
        </div>
    </div>
    <script>
        const app = document.getElementById('app');
        const screens = {
            home: document.getElementById('home-screen'),
            adminLogin: document.getElementById('admin-login-screen'),
            register: document.getElementById('register-screen'),
            forgotPassword: document.getElementById('forgot-password-screen'),
            adminPanel: document.getElementById('admin-panel'),
            gift: document.getElementById('gift-screen'),
            proposal: document.getElementById('proposal-screen'),
            final: document.getElementById('final-screen')
        };

        let currentUser = null;
        let selectedPhotos = [];
        let customMessages = {
            yes: "¡Gracias a Dios que no dijiste que sí!",
            no: "¡Gracias a Dios que dijiste que no!"
        };

        function showScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.remove('active'));
            screens[screenId].classList.add('active');
        }

        function generateUniqueLink() {
            return 'gift_' + Math.random().toString(36).substr(2, 9);
        }

        function saveGift(photos, messages) {
            const link = generateUniqueLink();
            localStorage.setItem(link, JSON.stringify({ photos, messages }));
            return link;
        }

        function loadGift(link) {
            return JSON.parse(localStorage.getItem(link));
        }

        function displayPhotos(containerId, photos) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            photos.forEach(photo => {
                const img = document.createElement('img');
                img.src = photo;
                container.appendChild(img);
            });
        }

        function saveUser(userData) {
            let users = JSON.parse(localStorage.getItem('users')) || {};
            users[userData.username] = userData;
            localStorage.setItem('users', JSON.stringify(users));
        }

        function getUser(username) {
            let users = JSON.parse(localStorage.getItem('users')) || {};
            return users[username];
        }

        document.getElementById('view-gift').addEventListener('click', () => {
            const giftId = new URLSearchParams(window.location.search).get('gift');
            if (giftId) {
                const gift = loadGift(giftId);
                if (gift) {
                    displayPhotos('gift-photo-gallery', gift.photos);
                    customMessages = gift.messages;
                    showScreen('gift');
                } else {
                    alert('Regalo no encontrado');
                }
            } else {
                alert('No hay regalo para mostrar');
            }
        });

        document.getElementById('admin-login').addEventListener('click', () => {
            showScreen('adminLogin');
        });

        document.getElementById('login').addEventListener('click', () => {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const user = getUser(username);
            if (user && user.password === password) {
                currentUser = username;
                showScreen('adminPanel');
            } else {
                alert('Usuario o contraseña incorrectos');
            }
        });

        document.getElementById('go-to-register').addEventListener('click', () => {
            showScreen('register');
        });

        document.getElementById('go-to-login').addEventListener('click', () => {
            showScreen('adminLogin');
        });

        document.getElementById('register').addEventListener('click', () => {
            const name = document.getElementById('register-name').value;
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value;

            if (getUser(username)) {
                alert('El usuario ya existe');
            } else {
                saveUser({ name, username, password, email, phone });
                alert('Usuario registrado con éxito');
                showScreen('adminLogin');
            }
        });

        document.getElementById('forgot-password').addEventListener('click', () => {
            showScreen('forgotPassword');
        });

        document.getElementById('send-recovery-code').addEventListener('click', () => {
            const username = document.getElementById('recovery-username').value;
            const user = getUser(username);
            if (user) {
                const recoveryCode = Math.random().toString(36).substr(2, 6);
                user.recoveryCode = recoveryCode;
                saveUser(user);
                alert(`Código de recuperación enviado a ${user.email} y ${user.phone}`);
                document.getElementById('recovery-code-section').classList.remove('hidden');
            } else {
                alert('Usuario no encontrado');
            }
        });

        document.getElementById('reset-password').addEventListener('click', () => {
            const username = document.getElementById('recovery-username').value;
            const recoveryCode = document.getElementById('recovery-code').value;
            const newPassword = document.getElementById('new-password').value;
            const user = getUser(username);
            if (user && user.recoveryCode === recoveryCode) {
                user.password = newPassword;
                delete user.recoveryCode;
                saveUser(user);
                alert('Contraseña restablecida con éxito');
                showScreen('adminLogin');
            } else {
                alert('Código de recuperación inválido');
            }
        });

        document.getElementById('upload-photos').addEventListener('click', () => {
            document.getElementById('photo-upload').click();
        });

        document.getElementById('photo-upload').addEventListener('change', (event) => {
            const files = event.target.files;
            selectedPhotos = [];
            for (let i = 0; i < Math.min(files.length, 3); i++) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    selectedPhotos.push(e.target.result);
                    displayPhotos('photo-gallery', selectedPhotos);
                };
                reader.readAsDataURL(files[i]);
            }
        });

        document.getElementById('save-photos').addEventListener('click', () => {
            if (selectedPhotos.length > 0) {
                alert('Fotos guardadas exitosamente');
            } else {
                alert('Por favor, sube fotos primero');
            }
        });

        document.getElementById('save-messages').addEventListener('click', () => {
            customMessages.yes = document.getElementById('yes-message').value || customMessages.yes;
            customMessages.no = document.getElementById('no-message').value || customMessages.no;
            alert('Mensajes guardados exitosamente');
        });

        document.getElementById('generate-link').addEventListener('click', () => {
            if (selectedPhotos.length > 0) {
                const link = saveGift(selectedPhotos, customMessages);
                const fullLink = `${window.location.origin}${window.location.pathname}?gift=${link}`;
                document.getElementById('generated-link').textContent = fullLink;
            } else {
                alert('Por favor, sube y guarda fotos primero');
            }
        });

        document.getElementById('copy-link').addEventListener('click', () => {
            const link = document.getElementById('generated-link').textContent;
            if (link) {
                navigator.clipboard.writeText(link).then(() => {
                    alert('Enlace copiado al portapapeles');
                });
            } else {
                alert('Genera un enlace primero');
            }
        });

        document.getElementById('admin-logout').addEventListener('click', () => {
            currentUser = null;
            showScreen('home');
        });

        document.getElementById('continue-button').addEventListener('click', () => {
            showScreen('proposal');
        });

        let yesClicks = 0;
        document.getElementById('yes-button').addEventListener('click', () => {
            yesClicks++;
            if (yesClicks < 5) {
                const button = document.getElementById('yes-button');
                const maxX = window.innerWidth - button.offsetWidth;
                const maxY = window.innerHeight - 

 button.offsetHeight;
                button.style.position = 'fixed';
                button.style.left = `${Math.random() * maxX}px`;
                button.style.top = `${Math.random() * maxY}px`;
            } else {
                showFinalScreen(customMessages.yes, "No quiero entregar mi alma al diablo. 😅");
            }
        });

        document.getElementById('no-button').addEventListener('click', () => {
            showFinalScreen(customMessages.no, "No quiero entregar mi alma al diablo. 😅");
        });

        function showFinalScreen(message, text) {
            document.getElementById('final-message').textContent = message;
            document.getElementById('final-text').textContent = text;
            showScreen('final');
        }

        // Check if there's a gift link in the URL
        const giftId = new URLSearchParams(window.location.search).get('gift');
        if (giftId) {
            const gift = loadGift(giftId);
            if (gift) {
                displayPhotos('gift-photo-gallery', gift.photos);
                customMessages = gift.messages;
                showScreen('gift');
            }
        }
    </script>
</body>
</html>
